<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="description" content="Shield Chat - Enterprise Secure Messaging">
  <title>Shield Chat - Messages</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="icon" type="image/png" href="/favicon.png">
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="user-info">
          <div class="avatar" id="currentUserAvatar">U</div>
          <div class="user-details">
            <span class="user-name" id="currentUserName">Loading...</span>
            <span class="user-status online">Online</span>
          </div>
        </div>
        <button class="icon-btn" id="menuBtn" aria-label="Menu">
          <svg viewBox="0 0 24 24" width="24" height="24">
            <path fill="currentColor" d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </button>
      </div>

      <!-- Search Users -->
      <div class="sidebar-search">
        <input type="text" id="searchUsers" placeholder="Search users to add...">
      </div>

      <!-- Search Results -->
      <div class="search-results" id="searchResults"></div>

      <!-- Pending Requests Section -->
      <div class="pending-requests-section" id="pendingRequestsSection">
        <div class="section-header" onclick="togglePendingRequests()">
          <span>Pending Requests</span>
          <span class="badge" id="pendingBadge" style="display: none;">0</span>
          <svg class="chevron" viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M7 10l5 5 5-5z"/>
          </svg>
        </div>
        <div class="pending-requests-list" id="pendingRequestsList">
          <div class="empty-state">No pending requests</div>
        </div>
      </div>

      <!-- Friends List -->
      <div class="friends-section">
        <div class="section-header">
          <span>Friends</span>
        </div>
        <nav class="users-list" id="friendsList">
          <div class="loading">Loading friends...</div>
        </nav>
      </div>

      <div class="sidebar-footer">
        <a href="/admin" class="admin-link" id="adminLink" style="display: none;">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
          </svg>
          Admin Panel
        </a>
        <button class="logout-btn" id="logoutBtn">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
          </svg>
          Logout
        </button>
      </div>
    </aside>

    <!-- Chat Area -->
    <main class="chat-area" id="chatArea">
      <!-- No Chat Selected State -->
      <div class="no-chat-selected" id="noChatSelected">
        <div class="no-chat-content">
          <svg viewBox="0 0 24 24" width="64" height="64">
            <path fill="#4f46e5" d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
          </svg>
          <h2>Welcome to Shield Chat</h2>
          <p>Select a friend from the sidebar to start messaging</p>
          <p class="hint">Use the search bar above to find and add friends</p>
        </div>
      </div>

      <!-- Active Chat -->
      <div class="active-chat" id="activeChat" style="display: none;">
        <header class="chat-header">
          <button class="back-btn" id="backBtn" style="display: none;">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
            </svg>
          </button>
          <div class="chat-user-info">
            <div class="avatar" id="chatUserAvatar">U</div>
            <div class="user-details">
              <span class="user-name" id="chatUserName">User Name</span>
              <span class="user-status" id="chatUserStatus">Offline</span>
            </div>
          </div>
          <div class="chat-actions">
            <button class="icon-btn" id="attachBtn" title="Send file" onclick="document.getElementById('fileInput').click()">
              <svg viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/>
              </svg>
            </button>
            <button class="icon-btn danger" id="deleteChatBtn" title="Delete conversation" onclick="window.chat?.deleteConversation(window.chat?.selectedUser?.id)">
              <svg viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
              </svg>
            </button>
            <button class="icon-btn danger" id="removeFriendBtn" title="Remove friend" onclick="window.chat?.removeFriend(window.chat?.selectedUser?.id)">
              <svg viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2H1v2h2v2h16v-2h2v-2h-7zM5 7a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm14 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4zM8 15h8v2H8v-2zm0-4h8v2H8v-2z"/>
              </svg>
            </button>
          </div>
        </header>

        <input type="file" id="fileInput" style="display: none;" onchange="window.chat?.sendFile()">

        <div class="messages-container" id="messagesContainer">
          <div class="messages-list" id="messagesList"></div>
        </div>

        <footer class="chat-footer">
          <div class="typing-indicator" id="typingIndicator" style="display: none;">
            <span class="typing-text">User is typing</span>
            <span class="typing-dots">
              <span></span><span></span><span></span>
            </span>
          </div>
          <form class="message-form" id="messageForm">
            <input type="text" id="messageInput" placeholder="Type a message..." autocomplete="off">
            <button type="submit" class="send-btn" id="sendBtn">
              <svg viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
              </svg>
            </button>
          </form>
        </footer>
      </div>
    </main>
  </div>

  <!-- Toast Notifications -->
  <div class="toast-container" id="toastContainer"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/api.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/chat.js"></script>
  <script src="/js/service-worker.js" defer></script>
  
  <script>
    // Toggle pending requests visibility
    function togglePendingRequests() {
      const section = document.getElementById('pendingRequestsSection');
      const list = document.getElementById('pendingRequestsList');
      const chevron = section.querySelector('.chevron');
      list.style.display = list.style.display === 'none' ? 'block' : 'none';
      chevron.style.transform = list.style.display === 'none' ? 'rotate(-90deg)' : 'rotate(0deg)';
    }
  </script>
</body>
</html>
